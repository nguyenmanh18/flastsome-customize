jQuery(document).ready(function(e){function t(){e("#unvalidated_rating").prop("name","rating"),e("#unvalidated_rating").prop("id","rating"),e("#title").val(""),e("textarea#comment").val(""),e("form#commentform").removeClass("edit-review"),e("form#commentform input#review_id").remove(),e("p.comment-form-rating").show(),e("p.upload_section").show(),e(".review_label").text(ywar.add_review_title),e("#cancel-comment-reply-link").is(":visible")&&e("#cancel-comment-reply-link").click()}function o(t){e(t).block({message:null,overlayCSS:{background:"#fff url("+ywar.loader+") no-repeat center",opacity:.6}})}function a(t){var o=e(t).attr("data-id_product"),a=e(t).attr("data-order");return{action:"get_ajax_comments",product_id:o,stars:e(t).attr("data-stars"),order:a,data_page:e(t).attr("data-page"),is_modal:e(t).attr("data-dialog"),_wpnonce:ywar.nonce_value,return_path:window.location.href}}e("body").off("click","#respond #submit");var r='<div id="modal_reviews" class="pp_pic_holder"><a class="pp_close" href="#"></a><div class="pp_content_container"><div class="pp_left"><div class="pp_right"><div class="pp_content"><div class="pp_loaderIcon"></div><div class="pp_fade"><a href="#" class="pp_expand" title="Expand the image">Expand</a><div id="pp_full_res"></div><div class="pp_details"><div class="pp_nav"><a href="#" class="pp_arrow_previous">Previous</a><p class="currentTextHolder">0/0</p><a href="#" class="pp_arrow_next">Next</a></div><p class="pp_description"></p></div></div></div></div></div></div></div><div class="pp_overlay"></div>';e(document).on("click","#cancel-comment-reply-link",function(e){t()}),e(document).on("click","a.ywar_votereview",function(t){if(t.preventDefault(),!e(this).hasClass("ywar_votereview_selected")){var o=e(this).attr("data-id_review"),a=e(this).attr("data-vote_review"),r={action:"vote_review",id_review:o,review_value:a,_wpnonce:ywar.nonce_value,return_path:window.location.href},i="#vote_yes_"+o,n="#vote_no_"+o,c=e(this).parent();c.block({message:null,overlayCSS:{background:"#fff url("+ywar.loader+") no-repeat center",opacity:.6}}),e.post(woocommerce_params.ajax_url,r,function(t){-1==t.code?top.location.replace(t.value):1==t.code&&(1==a?(e(i).addClass("vote_selected"),e(n).removeClass("vote_selected")):(e(n).addClass("vote_selected"),e(i).removeClass("vote_selected")),c.children(".ywar_review_helpful").empty().append(t.value)),c.unblock()})}}),e(document).on("click","a.review-inappropriate",function(t){t.preventDefault();var o={action:"report_inappropriate_review",id_review:e(this).attr("data-id_review"),_wpnonce:ywar.nonce_value,return_path:window.location.href},a=e(this).parent();a.block({message:null,overlayCSS:{background:"#fff url("+ywar.loader+") no-repeat center",opacity:.6}}),e.post(woocommerce_params.ajax_url,o,function(e){a.empty().append('<span class="inappropriate-content reported">'+e.value+"</span"),a.unblock()})}),e("#reviews #comments>h2").remove(),ywar.review_section_anchor&&e('a[href="#reviews"]').attr("href","#reviews_summary"),e(document).on("click","a.ywar_filter_reviews",function(i){i.preventDefault(),t();var n=e(this).attr("data-dialog");1!=n&&o("#reviews_summary"),e.post(woocommerce_params.ajax_url,a(e(this)),function(t){1!=n?(e("#reviews_header").empty().append(t.review_title),e("#comments ol.commentlist").empty().append(t.comment_list),e("div.ywar_show_more").empty().append(t.load_more),e("#reviews_summary").unblock()):(e("#reviews_dialog").empty().append('<ol class="commentlist">'+t.comment_list+"</ol>"),e("#reviews_dialog").append('<div class="ywar_show_more">'+t.load_more+"</div>"),"function"==typeof e.fn.prettyPhoto&&(e().prettyPhoto({markup:r,default_width:"70%",default_height:"200px",social_tools:!1,theme:"pp_woocommerce",modal:!0,callback:function(){e("#reviews_dialog").empty()}}),e.prettyPhoto.open("#reviews_dialog","","")),e("div.pp_pic_holder.pp_woocommerce").appendTo("#comments"))},"json")}),e(document).on("click","a.ywar_show_more, button.ywar_show_more_container",function(r){r.preventDefault(),t();var i=e(this);i.is("button")&&(i=i.children("a.ywar_show_more"));var n=i.attr("data-dialog");1!=n&&o(i),e.post(woocommerce_params.ajax_url,a(i),function(t){1!=n?(e("#reviews_header").empty().append(t.review_title),e("#reviews ol.commentlist").append(t.comment_list),e(i).unblock(),"function"==typeof e.fn.prettyPhoto&&e("a[data-rel^='prettyPhoto']").prettyPhoto({hook:"data-rel",social_tools:!1,theme:"pp_woocommerce",horizontal_padding:20,opacity:.8,deeplinking:!1})):e("#modal_reviews ol.commentlist").append(t.comment_list),e("body div.ywar_show_more").empty().append(t.load_more)},"json")});var i=!1;e("body").on("click",".ywar-review-thumbnails a",function(t){t.preventDefault(),i||("function"==typeof e.fn.prettyPhoto&&e("a[data-rel^='prettyPhoto']").prettyPhoto({hook:"data-rel",social_tools:!1,theme:"pp_woocommerce",horizontal_padding:20,opacity:.8,deeplinking:!1}),i=!0,e(this).trigger("click"))}),e(document).on("click","a.ywar_filter_order",function(r){r.preventDefault(),t(),i=!1,o("#reviews_order");var n=e(this);e.post(woocommerce_params.ajax_url,a(e(this)),function(t){e("#reviews_header").empty().append(t.review_title),e("ol.commentlist").empty().append(t.comment_list),e("div.ywar_show_more").empty().append(t.load_more),"most_recent_reviews"==n.attr("id")?(e("#most_recent_reviews").addClass("active"),e("#most_helpful_reviews").removeClass("active")):"most_helpful_reviews"==n.attr("id")&&(e("#most_helpful_reviews").addClass("active"),e("#most_recent_reviews").removeClass("active")),e("#reviews_order").unblock()},"json")}),e("a.ywar_filter_order.active").trigger("click"),e(document).on("click","a.edit-my-reviews",function(o){o.preventDefault();var a={action:"get_customer_reviews",product_id:e(this).data("product-id")};e("#ywar_reviews").block({message:null,overlayCSS:{background:"#fff url("+ywar.loader+") no-repeat center",opacity:.6}});e(this);e.post(woocommerce_params.ajax_url,a,function(t){e("#reviews_header").empty().append(t.review_title),e("ol.commentlist").empty().append(t.comment_list),e("#ywar_reviews").unblock()},"json"),t()}),e(document).on("click","a.comment-reply-link",function(t){e('select#rating option[value="5"]').prop("selected",!0),e("#title").val(""),e("textarea#comment").val(""),e("p.comment-form-rating").hide(),e("p.upload_section").hide(),e(".review_label").text(ywar.reply_to_review_title)}),e(document).on("click","a.comment-edit-link",function(t){var o=e(this).data("review-id");e("form#commentform").addClass("edit-review"),e("form#commentform").append('<input type="hidden" id="review-id" name="review-id" value="'+o+'" />'),e("p.upload_section").hide(),0!=e(this).data("parent")&&e("p.comment-form-rating").hide();var a=e(this).closest("div#comment-"+o),r=a.find("span.review_title").text();e("form#commentform #title").val(r);var i=a.find("span.review_content").text();e("form#commentform #comment").val(i);var n=e(this).data("rating");e('select#rating option[value="'+n+'"]').prop("selected",!0),e('.comment-form-rating a[class^="star-"]').removeClass("active"),e(".comment-form-rating a.star-"+n).addClass("active"),e(".review_label").text(ywar.edit_review_title)}),e(document).on("submit","form.edit-review",function(o){o.preventDefault();var a=e(this).parent();a.block({message:null,overlayCSS:{background:"#fff url("+ywar.loader+") no-repeat center",opacity:.6}});var r=e(this).find("#review-id").val(),i={action:"edit_review",review_id:r,review_title:e(this).find("#title").val(),review_content:e(this).find("textarea#comment").val(),review_rating:e(this).find("select#rating").val()};e.post(woocommerce_params.ajax_url,i,function(t){1==t.code&&e("#li-comment-"+r).replaceWith(t.content),a.unblock()}),t()}),e(document).on("click","a.goto-reviews",function(o){o.preventDefault(),t(),e.post(woocommerce_params.ajax_url,a(e(this)),function(t){1!=open_in_dialog?(e("#reviews_header").empty().append(t.review_title),e("#comments ol.commentlist").empty().append(t.comment_list),e("div.ywar_show_more").empty().append(t.load_more),e("#reviews_summary").unblock()):(e("#reviews_dialog").empty().append('<ol class="commentlist">'+t.comment_list+"</ol>"),e("#reviews_dialog").append('<div class="ywar_show_more">'+t.load_more+"</div>"),"function"==typeof e.fn.prettyPhoto&&(e().prettyPhoto({markup:r,default_width:"70%",default_height:"200px",social_tools:!1,theme:"pp_woocommerce",modal:!0,callback:function(){e("#reviews_dialog").empty()}}),e.prettyPhoto.open("#reviews_dialog","","")),e("div.pp_pic_holder.pp_woocommerce").appendTo("#comments"))},"json")}),e(document).on("click","#respond form#commentform #submit",function(t){e("span.empty-review").remove();var o=ywar.is_rating_required&&!e("select#rating").val(),a=!e("textarea#comment").val();o&&e(this).before('<span class="error empty-review">'+ywar.missing_rating_review+"</span>"),a&&e(this).before('<span class="error empty-review">'+ywar.empty_review_content+"</span>"),(o||a)&&t.preventDefault()})});